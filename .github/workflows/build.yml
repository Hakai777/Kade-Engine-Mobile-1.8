name: Basic Kade Engine Build

on:
  workflow_dispatch:

env:
  HAXE_VERSION: "4.3.4"
  LIME_VERSION: "8.0.2"
  OPENFL_VERSION: "9.2.2"

jobs:
  build:
    runs-on: ubuntu-latest

    steps:
    - name: Checkout repo
      uses: actions/checkout@v4

    - name: Install wget and dependencies
      run: sudo apt-get update && sudo apt-get install -y wget unzip libgl1-mesa-dev

    - name: Download and extract Haxe
      run: |
        wget -q https://github.com/HaxeFoundation/haxe/releases/download/${HAXE_VERSION}/haxe-${HAXE_VERSION}-linux64.tar.gz -O /tmp/haxe.tar.gz
        tar -xzf /tmp/haxe.tar.gz -C /tmp

    - name: Add Haxe binaries to PATH
      run: echo "/tmp/haxe-${HAXE_VERSION}-linux64" >> $GITHUB_PATH

    - name: Setup haxelib
      run: /tmp/haxe-${HAXE_VERSION}-linux64/haxelib setup .

    - name: Install Lime and OpenFL libs
      run: |
        /tmp/haxe-${HAXE_VERSION}-linux64/haxelib install lime ${LIME_VERSION} --always
        /tmp/haxe-${HAXE_VERSION}-linux64/haxelib install openfl ${OPENFL_VERSION} --always

    - name: Build APK
      run: |
        /tmp/haxe-${HAXE_VERSION}-linux64/haxelib run lime build android -final
